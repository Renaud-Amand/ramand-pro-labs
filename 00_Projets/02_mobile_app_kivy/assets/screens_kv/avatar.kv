#:kivy 2.3.0
# assets/screens_kv/avatar.kv
#
# Ã‰cran : Constructeur d'avatar (AvatarScreen)
# RÃ¨gles DYS appliquÃ©es :
#   - Fond ivoire (#FDFBEE)  â€” pas de blanc pur
#   - Boutons â‰¥ 56dp         â€” MIN_BUTTON_HEIGHT
#   - Aucun motif/texture    â€” aplats de couleur uniquement
#   - Espacement gÃ©nÃ©reux    â€” 24dp entre sections
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

<AvatarColorButton@Button>:
    # â”€â”€ Bouton de sÃ©lection de couleur dans la grille â”€â”€
    size_hint:      None, None
    size:           dp(52), dp(52)
    background_color: 0, 0, 0, 0         # On gÃ¨re la couleur via canvas
    border:         0, 0, 0, 0
    canvas.before:
        Color:
            rgba: self.background_normal  # surcharge en Python au moment du bind
        Ellipse:
            size: self.size
            pos:  self.pos
        Color:
            rgba: (0.80, 0.76, 0.72, 1) if self.state == 'normal' else (0.26, 0.52, 0.96, 1)
        Line:
            ellipse: self.x, self.y, self.width, self.height
            width:   2


<CategoryButton@Button>:
    # â”€â”€ Bouton de catÃ©gorie (Peau / Cheveux / Yeux / Habits) â”€â”€
    size_hint:       1, None
    height:          dp(56)              # MIN_BUTTON_HEIGHT
    font_name:       "OpenDyslexic"
    font_size:       sp(17)
    color:           0.15, 0.15, 0.20, 1
    background_color: 0, 0, 0, 0
    canvas.before:
        Color:
            rgba: (0.898, 0.761, 0.624, 0.35) if self.state == 'down' else (0.933, 0.918, 0.886, 1)
        RoundedRectangle:
            size:   self.size
            pos:    self.pos
            radius: [dp(12), ]
        Color:
            rgba: (0.839, 0.541, 0.486, 1) if self.state == 'down' else (0.80, 0.76, 0.72, 0.6)
        Line:
            rounded_rectangle: self.x, self.y, self.width, self.height, dp(12)
            width: 1.2


<AvatarScreen>:
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    # Ã‰cran racine â€” Fond ivoire
    # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    canvas.before:
        Color:
            rgba: 0.992, 0.984, 0.933, 1    # #FDFBEE
        Rectangle:
            size: self.size
            pos:  self.pos

    BoxLayout:
        orientation: "vertical"
        padding:     dp(20)
        spacing:     dp(24)

        # â”€â”€ 1. Titre de l'Ã©cran â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Label:
            id:              title_label
            text:            "Mon Avatar"
            font_name:       "OpenDyslexic"
            font_size:       sp(28)
            color:           0.15, 0.15, 0.20, 1
            size_hint_y:     None
            height:          dp(48)
            halign:          "center"

        # â”€â”€ 2. PrÃ©visualisation de l'avatar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        # (Image construite dynamiquement en Python via AvatarBuilder)
        BoxLayout:
            id:            avatar_preview_area
            size_hint:     1, None
            height:        dp(220)
            padding:       dp(8)

            canvas.before:
                Color:
                    rgba: 0.933, 0.918, 0.886, 1    # Fond legÃ¨rement plus sombre
                RoundedRectangle:
                    size:   self.size
                    pos:    self.pos
                    radius: [dp(20), ]

            # Widget Image remplacÃ©/mis Ã  jour depuis Python :
            # root.ids.avatar_preview_area.add_widget(AvatarWidget())
            Image:
                id:              avatar_preview
                source:          ""              # Source initialisÃ©e en Python
                allow_stretch:   True
                keep_ratio:      True

        # â”€â”€ 3. Navigation entre catÃ©gories â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        GridLayout:
            id:          category_nav
            cols:        4
            size_hint_y: None
            height:      dp(64)
            spacing:     dp(8)

            CategoryButton:
                id:      btn_skin
                text:    "ğŸ‘¤ Peau"
                on_press: root.select_category("skin")

            CategoryButton:
                id:      btn_hair
                text:    "ğŸ’‡ Cheveux"
                on_press: root.select_category("hair")

            CategoryButton:
                id:      btn_eyes
                text:    "ğŸ‘ï¸ Yeux"
                on_press: root.select_category("eyes")

            CategoryButton:
                id:      btn_clothes
                text:    "ğŸ‘• Habits"
                on_press: root.select_category("clothes")

        # â”€â”€ 4. Grille de sÃ©lection couleurs/formes â”€â”€â”€â”€â”€â”€
        # Remplie dynamiquement depuis Python via populate_color_grid()
        ScrollView:
            id:              color_scroll
            size_hint:       1, 1
            bar_width:       dp(4)
            bar_color:       0.80, 0.76, 0.72, 0.6

            GridLayout:
                id:              color_grid
                cols:            5
                size_hint_y:     None
                height:          self.minimum_height
                padding:         dp(12)
                spacing:         dp(12)

                # Les AvatarColorButton sont injectÃ©s dynamiquement :
                # for hex_color in palette: color_grid.add_widget(AvatarColorButton(...))

        # â”€â”€ 5. Bouton de validation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        Button:
            id:              btn_validate
            text:            "âœ… Valider mon avatar"
            font_name:       "OpenDyslexic"
            font_size:       sp(18)
            size_hint_y:     None
            height:          dp(60)
            color:           0.992, 0.984, 0.933, 1
            background_color: 0, 0, 0, 0
            on_press:        root.save_avatar()
            canvas.before:
                Color:
                    rgba: (0.478, 0.329, 0.227, 1) if self.state == 'down' else (0.651, 0.486, 0.322, 1)
                RoundedRectangle:
                    size:   self.size
                    pos:    self.pos
                    radius: [dp(14), ]
